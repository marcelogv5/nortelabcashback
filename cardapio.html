function enviarCardapio() {
  if (!isPagoConfirmado) {
    alert("Favor confirmar o recebimento.");
    return;
  }

  let usado = 0;
  let itensSelecionados = [];
  for (let item in precos) {
    const qtd = parseInt(form[item].value || "0");
    if (qtd > 0) {
      usado += qtd * precos[item];
      itensSelecionados.push(`${item} (${qtd})`);
    }
  }

  const sobra = Math.max(0, credito - usado);
  const dados = {
    nome: nome,
    req: req,
    itens: itensSelecionados.join(", "),
    usado: usado,
    sobra: sobra,
    pagamento: document.getElementById("pagamento").value || "",
    recebidoPor: document.getElementById("recebidoPor").value || ""
  };

  const formData = new FormData();
  for (const key in dados) {
    formData.append(key, dados[key]);
  }

  fetch("https://script.google.com/macros/s/AKfycbynLSiRnLR6KXI9VeWXvi-1P4ktZDuMcAlZmMunpilN0dlnKh7eaaRwAyvEFWI7fdM/exec", {
    method: "POST",
    mode: "no-cors",
    body: formData
  }).then(() => {
    window.location.href = "index.html"; // volta para página inicial
  }).catch(err => {
    alert("Erro ao enviar cardápio");
    console.error(err);
  });
}
